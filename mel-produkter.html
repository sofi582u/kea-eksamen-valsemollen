<!DOCTYPE html>
<html lang="da">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO meta tags -->
    <title>BORNHOLMS VALSEMØLLE | Produkter</title>
    <meta name="description" content="På Bornholms Valsemølle lægger vi stor vægt på en skånsom formaling af kornet.">
    <meta name="keywords" content="korn, mel, økologisk mel, emmermel, konventionelt, melproduktion, lokalt, bagning, bagværk">
    <!--------------->
    <!-------Style-------->
    <link rel="stylesheet" href="CSS/global.css">
    <!--------------->
    <!--Favicon-->
    <link rel="icon" type="image/png" sizes="32x32" href="img/LOGO1.svg">
    <!--------------->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P50MG5L43Q"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'G-P50MG5L43Q');

    </script>
    <!--------------->
</head>

<body>
    <header>
        <!--BRAND-->
        <a href="index.html" class="brand">
            <div class="logo-icon"></div>
        </a>
        <!---->
        <!--NAV-->
        <nav>
            <ul id="menu" class="hidden">
                <li><a href="index.html">HOME</a></li>
                <li><a class="current" href="mel-produkter.html">PRODUKTER</a></li>
                <li><a href="opskrifter.html">OPSKRIFTER</a></li>
                <li><a href="om-os.html">OM OS</a></li>
                <li><a href="partnere.html">PARTNERE</a></li>
                <li><a href="kontakt.html">KONTAKT</a></li>
            </ul>
        </nav>
        <!---->
        <!--SOCIAL ICONS-->
        <div class="icons hidden">
            <!--SOCIALMEDIA-->
            <a href="https://www.instagram.com/xxx/" target="_blank">
                <img class="header-social-icon" src="img/instagram.svg" alt="instagram" />
            </a>
            <a href="https://www.facebook.com/pages/Bornholms-valsemølle/333460753369929" target="_blank">
                <img class="header-social-icon" src="img/facebook.svg" alt="facebook" />
            </a>
            <!---->
        </div>
        <!---->
        <!--MOBILE MENU ICON-->
        <div id="menubutton">
            <img class="header-menu-icon" src="img/burger-menu-icon.svg" alt="Menu icon" />
        </div>
        <!---->
    </header>


    <main class="">

        <!--SECTION SPLASH-->
        <section class="hero-image">
            <img class="hero-video" src="img/hero-produkt.png" alt="historien">

            <div class="hero-overlay"></div>

            <section class="titletext">
                <h1>PRODUKTER</h1>
            </section>

        </section>
        <!--------------------------->

        <!----TWO-COLUMN-SECTION----->
        <section class="two-column-section">
            <div class="two-column-sides-2">
                <div class="two-column-text">
                    <h2>VORES PRODUKTER</h2>
                    <p>Møllen producerer både fine og grove melsorter af såvel konventionelt som økologisk korn. Kornet males dels på valser dels på stenkværn. Kornsorterne spænder fra den traditionelle danske hvede og rug til mere eksotiske sorter som spelt, durum, ølandshvede, manitoba og emmer. Nye produkter lanceres løbende.
                        <br><br>
                        Alle vores produkter er 100% sporbare. Se her hvor vi får kornet fra:
                        <br>
                    </p>
                    <a href="partnere.html#leverandor" class="button-container">
                        <div class="cta-button">Leverandører</div>
                    </a>
                </div>
                <div class="two-column-image">
                    <img src="img/mel-version1.png" alt="konventional">
                </div>
            </div>
        </section>
        <!--------------------------->

        <!----TWO-COLUMN-SECTION----->
        <section class="two-column-section">
            <div class="two-column-sides">
                <div class="two-column-text">
                    <h2>ØKOLOGISKE PRODUKTER</h2>
                    <p>De økologiske produkter omfatter mel af følgende kornsorter:

                        Hvede,

                        Spelt,

                        Rug,

                        Durum,

                        Emmer,

                        og Ølandshvede.

                        <br> Se vores produktudvalg og læs om de forskellige kornsorter under hvert enkelt produkt.</p>
                </div>
                <div class="two-column-image">
                    <img src="img/mel-%C3%B8ko-mel.png" alt="eco">
                </div>
            </div>
        </section>
        <!--------------------------->

        <!----TWO-COLUMN-SECTION----->
        <section class="two-column-section">
            <div class="two-column-sides-2">
                <div class="two-column-text">
                    <h2>KONVENTIONELLE PRODUKTER</h2>
                    <p>De konventionelle produkter omfatter mel af følgende kornsorter:

                        Hvede,

                        Rug,

                        Durum,

                        Ølandshvede,

                        Manitoba,

                        og Spelt.

                        <br>Se vores produktudvalg og læs om de forskellige kornsorter under hvert enkelt produkt.</p>
                </div>
                <div class="two-column-image">
                    <img src="img/konventionel-mel.png" alt="konventional">
                </div>
            </div>
        </section>
        <!--------------------------->

        <!----CATEGORY PRODUCT SECTION----->
        <section id="cta-list-sortering" class="product-sektion">
            <!--            <div class="container js-category-box"></div>-->
            <div class="section-width">
                <h2>SORTIMENT</h2><br>
                <p>Alle vores produkter kan også ses i <a href="https://bornholms-valsemoelle.dk/gtin.html">Sortimentlisten</a>.</p>
            </div>
            <section>
                <div class="category-list-container">
                    <ul class="category-list">
                        <li class="category-list__item">
                            <a href="alle-produkter.html?filter=alle-produkter" class="category-list__link js-category-button" data-category="alle-produkter">
                                <div>
                                    <img src="img/ikoner-alle.svg" alt="alle-produkter" class="category-list__icon">
                                </div>
                                <h3>Alle produkter</h3>
                            </a>
                        </li>
                        <li class="category-list__item">
                            <a href="alle-produkter.html?filter=konventionel" class="category-list__link js-category-button" data-category="konventionel">
                                <div>
                                    <img src="img/ikoner-konventionel.svg" alt="konventionel" class="category-list__icon">
                                </div>
                                <h3>Konventionelt</h3>
                            </a>
                        </li>
                        <li class="category-list__item">
                            <a href="alle-produkter.html?filter=oekologisk" class="category-list__link js-category-button" data-category="oekologisk">
                                <div>
                                    <img src="img/ikoner-oko.svg" alt="økologisk" class="category-list__icon">
                                </div>
                                <h3>Økologisk</h3>
                            </a>
                        </li>
                        <li class="category-list__item">
                            <a href="alle-produkter.html?filter=kerner" class="category-list__link js-category-button" data-category="kerner">
                                <div>
                                    <img src="img/ikoner-korn.svg" alt="korn" class="category-list__icon">
                                </div>
                                <h3>Kerner</h3>
                            </a>
                        </li>
                    </ul>
                </div>
            </section>

            <section class="products">
                <div class="container_products">
                    <div class="product-list js-product-list"></div>
                </div>
            </section>

        </section>

        <!----END CATEGORY PRODUCT SECTION----->


    </main>



    <!--FOOTER-->
    <footer>
        <!--FOOTER COLUMN WRAPPER-->
        <div class="footerinfo">
            <!--FOOTER COLUMN-->
            <div class="footercolumn">
                <h3>Kontakt</h3>
                <ul>
                    <li><a href="tel:56974085">Tlf: 56 97 40 39</a></li>
                    <li>
                        <a href="mailto:info@bornholms-valsemoelle.dk">Email: info@bornholms-valsemoelle.dk</a>
                    </li>
                </ul>
            </div>
            <!---->
            <!---->
            <div class="footercolumn">
                <h3>Adresse</h3>
                <a href="https://goo.gl/maps/pf2UzgVoK2p7RSEB6">
                    <ul>
                        <li>
                            <p>Bornholm Valsemølle A/S</p>
                        </li>
                        <li>
                            <p>Møllebakken 5, 3720 Aakirkeby</p>
                        </li>
                    </ul>
                </a>
            </div>
            <!---->
            <!---->
            <div class="footercolumn">
                <h3>Åbningstider</h3>
                <ul>
                    <li>
                        <p>Mandag - Fredag 8.00 - 14.30</p>
                    </li>
                    <li>
                        <p>Lørdag Lukket</p>
                    </li>
                    <li>
                        <p>Søndag Lukket</p>
                    </li>
                </ul>
            </div>
            <!---->
            <!---->
            <div class="footercolumn">
                <!--SOCIAL MEDIA BOX-->
                <div class="socialmediabox">
                    <!--FOOTER SOCIALMEDIA LINK-->
                    <a href="https://www.facebook.com/bornholmsvalsemoelle">
                        <div class="footersocialicon">
                            <img class="footer-social-icon" src="img/facebook.svg" alt="facebook" />
                        </div>
                    </a>
                    <!---->
                    <!---->
                    <a href="https://www.instagram.com">
                        <div class="footersocialicon">
                            <img class="footer-social-icon" src="img/instagram.svg" alt="instagram" />
                        </div>
                    </a>
                    <!---->
                </div>
                <!---->
                <!--FIND SMILEY WRAPPER-->
                <a href="https://www.findsmiley.dk/119235">
                    <img class="footer-findsmiley" src="img/findsmiley.jpg" alt="kontrolrapport" />
                </a>
                <!---->
            </div>
            <!---->
            <!--END FOOTER COLUMN-->
        </div>
        <!--END FOOTER COLUMN WRAPPER-->
    </footer>
    <!---->

    <!--LIST OBJECT TEMPLATE-->

    <template class="js-t-product">
        <article class="product">
            <a href="#" class="js-product__link" data-product-id="">
                <div class="css__list-object__image-container">
                    <img class="product__image" src="#" alt="#">
                </div>
                <h3 class="product__name"></h3>
            </a>
            <p class="css__product__category-text"><span class="product__category"></span> </p>
            <p class="product__short-text"><span class="short-text"></span> </p>
        </article>
    </template>

    <!--------------->

    <script src="JS/global.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", init);

        // Opretter globale variabler
        let findCategory;
        let categories;
        let filter;
        let products;


        // Kategori produkt URL
        const categoriesUrl = 'https://sljfineart.com/kea/sem-4/valsemoellen/wp-json/wp/v2/categories';
        const productsUrl = 'https://sljfineart.com/kea/sem-4/valsemoellen/wp-json/wp/v2/meltype?per_page=100';
        //henter template og indsaetter i html
        const productTemplate = document.querySelector(".js-t-product");
        const productList = document.querySelector(".js-product-list");


        function hentFilterFraUrl() {
            //tager hele urlen ...alle-produkter.html?filter=alle-produkter
            let queryString = window.location.search;
            //tager kun sidste del af urlen fra ?filter
            let urlParams = new URLSearchParams(queryString);
            //finder det aktive filter (filter=okologisk) eksempelvis
            let urlFilter = urlParams.get('filter');


            //har sat ...alle-produkter.html uden filter til altid at have filteret alle produkter
            //ellers er den lig med det filter man har valgt
            if (urlFilter === null) {
                filter = "alle-produkter";
            } else {
                filter = urlFilter;
            }

            //giver den klikkede button en farve
            document.querySelector(`.js-category-button[data-category="${filter}"]`).classList.add("button-clicked");
        }



        // asynkron funktion
        async function init() {

            hentFilterFraUrl()
            await getCategories();
            // Henter alle produkter --> getProducts() retunerer
            await getProducts();
            showProducts(products);
            initCategoryButtons();
        }


        // Henter alle produktkategorier
        async function getCategories() {
            console.log('getCategories');

            // Bruger fetch API til at hente JSON data
            const response = await fetch(categoriesUrl);
            // Afventer data, laves om til JSON som Javascript kan forstå og gemmes i global variabel kaldet categories
            categories = await response.json();

        }


        async function getProducts() {
            console.log('getProducts');

            const response = await fetch(productsUrl);
            products = await response.json();
            console.log(products);

        }

        // dette gores da nogle af varerne har mere end en kategori, saa produkterne kan blive vist i mere en en kategori
        function categoriIdTilNavn(product) {

            //det er en array[]
            let productCategoriesList = [];
            //looper dette produkts kategori id'er igennem
            product.categories.forEach((category, index) => {

                let findProductCategory = categories.find(productCategory => productCategory.id === category);

                console.log('findProductCategory', findProductCategory);
                //ideerne pushes til produktkategorilisten
                //ikke lig med null
                if (findProductCategory !== null) {
                    productCategoriesList.push(findProductCategory);
                }

            });

            return productCategoriesList
        }

        function showProducts(products) {
            console.log('showProducts');

            // Nulstil produktlisten man ligger den nye filtrering oveni hvis ikke man nulstiller
            productList.innerHTML = '';

            //finder den kategori i vores kategorivariabel der har den samme slug navn som vores filter i urlen
            findCategory = categories.find(category => category.slug === filter);


            // Opdaterer URL'en med det nye filter parametre (var den der ikke ville det ikke aendre sig i url'en, ved refresh ville den nulstille uden sidste filtrering
            window.history.replaceState(null, null, `?filter=${filter}`);

            // Loop igennem alle produkter hver gang der klikkes paa ny kategori
            products.forEach(product => {

                const productCategoriesList = categoriIdTilNavn(product)

                //sorger for at det kun er produkter inden for en vis kategori der vises
                //hvis filteret passer til en af de kategorier eller flere der er tilfojet til produktet saa skal det vises og ellers ikke
                let findMatch = productCategoriesList.find(category => category.slug === filter);
                console.log(findMatch)
                if (filter === 'alle-produkter' || findMatch !== undefined) {
                    //productTemplate - find template / content - tag kun indholdet / cloneNode(true) - tag en kopi
                    const productClone = productTemplate.content.cloneNode(true);
                    //alt under bliver sat ind i templaten ovenover
                    productClone.querySelector(".product").setAttribute('data-product-id', product.id);
                    productClone.querySelector(".js-product__link").href = `produkt.html?name=${product.slug}`;
                    productClone.querySelector(".product__image").src = product.thumbnail.guid;
                    productClone.querySelector(".product__image").alt = product.title.rendered;
                    productClone.querySelector(".product__name").textContent = product.title.rendered;
                    productClone.querySelector(".product__category").textContent = product.kategori;
                    productClone.querySelector(".product__short-text").textContent = product.shorttext;

                    productList.appendChild(productClone);

                }
            });

        }


        function initCategoryButtons() {
            console.log('initCategoryButtons');
            //tager fat i alle kategoriknapper - alle buttons bliver lagt ind som en array i variablen kategorybuttons
            const categoryButtons = document.querySelectorAll(".js-category-button");
            //for hver knap man trykker paa bliver man fort til filterProducts funktionen
            categoryButtons.forEach(categoryButton => {

                categoryButton.addEventListener("click", filterProducts);
            });
        }



        function filterProducts(event) {
            console.log(this);
            //dynamisk
            event.preventDefault();
            //vores filter skal laves om til det der er klikket paa - til vores kategoridata atribut: data=categori="tasker" f.eks
            filter = this.dataset.category;
            console.log('filter', filter);
            //fjerner og tilfojer farven paa kliket knap
            document.querySelectorAll(".js-category-button").forEach(category => category.classList.remove("button-clicked"));
            this.classList.add("button-clicked");
            //viddere til ny kategori
            showProducts(products);
        }

    </script>
</body>

</html>
